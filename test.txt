import { throwError } from 'rxjs';
import { fakeAsync, tick } from '@angular/core/testing';
import { LOADINGACTION } from 'src/app/shared/actions/loading.actions'; // adjust path if needed

it('GenerateTableRows(): error -> should call displayServiceErrors, clear loading and dispatch LOADINGACTION(false)', fakeAsync(() => {
  // Arrange
  (component as any).appConfigService = (component as any).appConfigService || {} as any;
  (component as any).appConfigService.getAllAccrualTaxAcctUrl = '/api/taxaccounts';

  // Mock error response
  const errorResponse = { error: { statusMessage: 'Server error while fetching tax accounts' } };

  // Spy dependencies
  spyOn(component.feeApiservice, 'getRequest').and.returnValue(throwError(() => errorResponse));
  const displaySpy = spyOn(component as any, 'displayServiceErrors');
  (component as any).store = (component as any).store || { dispatch: () => {} };
  const dispatchSpy = spyOn(component['store'], 'dispatch');

  component.loading = true;

  // Act
  (component as any).GenerateTableRows();
  tick();

  // Assert
  expect(component.feeApiservice.getRequest).toHaveBeenCalledWith('/api/taxaccounts');
  expect(displaySpy).toHaveBeenCalledWith('Server error while fetching tax accounts');
  expect(component.loading).toBeFalse();
  expect(dispatchSpy).toHaveBeenCalledWith(jasmine.any(LOADINGACTION));
}));