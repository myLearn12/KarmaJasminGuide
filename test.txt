it('ngOnInit(): on error should call displayServiceErrors, possibly LoadDefaultComboBox for 404, clear loading and dispatch LOADINGACTION(false)', fakeAsync(() => {
  // Arrange
  spyOn(component['authService'], 'canHideFinanceAdminControls').and.returnValue(false);

  const errorResponse = { error: { statusMessage: 'server down', statusCode: '404' } };
  const displaySpy = spyOn(component as any, 'displayServiceErrors');
  const loadDefaultSpy = spyOn(component as any, 'LoadDefaultComboBox');
  const dispatchSpy = spyOn(component['store'], 'dispatch');

  // make feeApiservice.getRequest return error for any URL
  spyOn(component.feeApiservice, 'getRequest').and.returnValue(throwError(() => errorResponse));

  // Act
  component.ngOnInit();
  tick();

  // Assert
  expect(displaySpy).toHaveBeenCalledWith('server down');
  expect(loadDefaultSpy).toHaveBeenCalled(); // because statusCode was 404
  expect(component.loading).toBeFalse();
  expect(dispatchSpy).toHaveBeenCalledWith(jasmine.any(LOADINGACTION));
}));

it('ngOnInit(): on complete should set combo data, clone ViewChild.options, clear loading and dispatch LOADINGACTION(false)', fakeAsync(() => {
  // Arrange
  spyOn(component['authService'], 'canHideFinanceAdminControls').and.returnValue(false);

  const costCenters = [{ costCenterId: 1, costCenterNbr: '100', costCenterDesc: 'Cost A' }];
  const divisions = [{ divisionId: 20, divisionCd: 'D1', divisionDesc: 'Division A' }];
  const altDivMaps: any[] = [];

  spyOn(component.feeApiservice, 'getRequest').and.callFake((url: string) => {
    if (url.includes('costcenter')) return of(costCenters);
    if (url.includes('division')) return of(divisions);
    if (url.includes('altdiv')) return of(altDivMaps);
    return of([]);
  });

  const mappedDivisions = [{ label: 'Division A', value: '20' }];
  const mappedCostCenters = [{ label: 'Cost A', value: '100' }];
  spyOn(component['utils'], 'LoadComboBoxData').and.callFake((arr, label) => {
    if (label === 'divisionDesc') return mappedDivisions;
    if (label === 'costCenterDesc') return mappedCostCenters;
    return [];
  });

  (component as any)._divisionComboBox = { options: null };
  (component as any)._costCenterComboBox = { options: null };
  const dispatchSpy = spyOn(component['store'], 'dispatch');

  // Act
  component.ngOnInit();
  tick();

  // Assert
  expect(component.divisionComboBoxData).toEqual([{ options: mappedDivisions }]);
  expect(component.costCenterComboBoxData).toEqual([{ options: mappedCostCenters }]);

  expect((component as any)._divisionComboBox.options).toEqual(JSON.parse(JSON.stringify(divisions)));
  expect((component as any)._costCenterComboBox.options).toEqual(JSON.parse(JSON.stringify(costCenters)));

  expect(component.loading).toBeFalse();
  expect(dispatchSpy).toHaveBeenCalledWith(jasmine.any(LOADINGACTION));
}));