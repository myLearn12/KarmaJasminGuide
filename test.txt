import { fakeAsync, tick } from '@angular/core/testing';
import { of } from 'rxjs';
import { LOADINGACTION } from 'src/app/shared/actions/loading.actions'; // <-- adjust path

it('ngOnInit: when selector yields object with regionId undefined -> clears loading, dispatches LOADINGACTION(false) and redirects', fakeAsync(() => {
  // Arrange
  // spy store.pipe(select(...)) to emit an object whose regionId is undefined
  spyOn(component['store'], 'pipe').and.returnValue(of({ regionId: undefined }));

  // spy dispatch and utils.redirectToRegionSelection
  const dispatchSpy = spyOn(component['store'], 'dispatch');
  const redirectSpy = spyOn(component['utils'], 'redirectToRegionSelection');

  // Act
  component.ngOnInit();
  tick();

  // Assert: loading should be false
  expect(component.loading).toBeFalse();

  // Assert: dispatch was called with a LOADINGACTION (we accept any LOADINGACTION instance)
  expect(dispatchSpy).toHaveBeenCalledWith(jasmine.any(LOADINGACTION));

  // Assert: redirect was called
  expect(redirectSpy).toHaveBeenCalled();
}));


it('ngDoCheck(): when changeTable has rows -> should set isData=true and loading=false', () => {
  // Arrange
  const mockChangeTable = [{ id: 1, name: 'Row1' }];

  // Spy on reportService.getChangeTable() to return non-empty data
  spyOn(component['reportservice'], 'getChangeTable').and.returnValue(mockChangeTable);

  // Initial state
  component.isData = false;
  component.loading = true;

  // Act
  component.ngDoCheck();

  // Assert
  expect(component.isData).toBeTrue();
  expect(component.loading).toBeFalse();
});