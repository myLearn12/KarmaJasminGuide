it('ActionType.update: when PUT completes -> should regenerate table, show success and call auditLogService.writeAuditLog', fakeAsync(() => {
  // --- Arrange: minimal, self-contained setup inside the test ---
  // Provide viewchild-like holders (strings expected by getUpdatedModel())
  (component as any)._controlIdComboBox = { value: '200' };
  (component as any)._branchCdComboBox = { value: 'BR01' };

  // Make the collections used by getUpdatedModel() real arrays so .find works
  (component as any).controlIds = [
    { conId: 200, controlDesc: 'Control 200' },
    { conId: 201, controlDesc: 'Control 201' }
  ];
  // If getUpdatedModel reads other collections (divisions/regions/costCenters), provide them too:
  (component as any).divisions = [
    { divisionId: 10, divisionCd: 'D10', divisionDesc: 'Division 10' }
  ];
  (component as any).regions = [{ regionId: 1, regionDescription: 'R1' }];

  // Selected snapshot (original) and mutated model (simulates user edits)
  component.selectedtaxAccount = {
    taxAcctId: 42,
    acctNbr: 'OLD-ACCT',
    glAcctNbr: 'GL-OLD',
    controlId: 200,
    branchCode: 'BR01'
  } as any;

  component.taxAccount = {
    taxAcctId: 42,
    acctNbr: 'NEW-ACCT',
    glAcctNbr: 'GL-NEW',
    controlId: 200,
    branchCode: 'BR01'
  } as any;

  // Make validateFormControls allow the flow
  spyOn(component as any, 'validateFormControls').and.returnValue(false);

  // Stub the HTTP put to succeed
  const putSpy = spyOn(component.feeApiservice, 'putRequest').and.returnValue(of({}));

  // Spy side-effect helpers called by success handling
  const genSpy = spyOn(component as any, 'GenerateTableRows').and.callFake(() => {});
  const setMsgSpy = spyOn(component as any, 'SetMessageTypeAndValue').and.callFake(() => {});
  // auditLogService may be private â€” access via (component as any).auditLogService
  const auditSpy = spyOn((component as any).auditLogService || {}, 'writeAuditLog').and.callFake(() => {});
  const clearSpy = spyOn(component as any, 'clearSelection').and.callFake(() => {});
  const hideSpy = spyOn((component as any)._actionModal || {}, 'hide').and.callFake(() => {});

  // --- Act ---
  component.onAcceptButtonClick(ActionType.update);
  tick();

  // --- Assert ---
  expect(putSpy).toHaveBeenCalled(); // putRequest invoked
  expect(genSpy).toHaveBeenCalled(); // table regenerated on success
  expect(setMsgSpy).toHaveBeenCalledWith(jasmine.anything(), jasmine.anything()); // success message set
  expect(auditSpy).toHaveBeenCalledWith(
    'taxAcctId',
    component.taxAccount.taxAcctId.toString(),
    component.selectedtaxAccount,
    jasmine.any(Object),
    jasmine.anything(),
    jasmine.any(String)
  );
  expect(clearSpy).toHaveBeenCalled(); // selection cleared
  expect(hideSpy).toHaveBeenCalled(); // modal hidden
}));