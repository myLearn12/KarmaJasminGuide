it('ActionType.update: when PUT completes -> should regenerate table, show success and call auditLogService.writeAuditLog', fakeAsync(() => {
  // --- Make viewchildren-like holders present (strings used by getUpdatedModel) ---
  (component as any)._controlIdComboBox = { value: '200' };
  (component as any)._branchCdComboBox = { value: 'BR01' };
  (component as any)._regionComboBox = { value: '1' }; // if used

  // --- Provide arrays so .find(...) won't crash ---
  (component as any).controlIds = [{ conId: 200, controlDesc: 'Control 200' }];
  (component as any).branchCds = [{ branchCode: 'BR01', branchDesc: 'Branch 1' }]; // IMPORTANT: fixes branchCds.find error
  (component as any).regions = [{ regionId: 1, regionDescription: 'R1' }]; // if getUpdatedModel uses regions
  (component as any).divisions = [{ divisionId: 10, divisionCd: 'D10', divisionDesc: 'Division 10' }];

  // --- Provide selected snapshot (original) and mutated model (UI edits) ---
  component.selectedtaxAccount = {
    taxAcctId: 42,
    acctNbr: 'OLD-ACCT',
    glAcctNbr: 'GL-OLD',
    controlId: 200,
    branchCode: 'BR01'
  } as any;

  component.taxAccount = {
    taxAcctId: 42,
    acctNbr: 'NEW-ACCT',
    glAcctNbr: 'GL-NEW',
    controlId: 200,
    branchCode: 'BR01'
  } as any;

  // allow flow
  spyOn(component as any, 'validateFormControls').and.returnValue(false);

  // HTTP put succeeds
  const putSpy = spyOn(component.feeApiservice, 'putRequest').and.returnValue(of({}));

  // Spy side-effects
  const genSpy = spyOn(component as any, 'GenerateTableRows').and.callFake(() => {});
  const setMsgSpy = spyOn(component as any, 'SetMessageTypeAndValue').and.callFake(() => {});
  const clearSpy = spyOn(component as any, 'clearSelection').and.callFake(() => {});
  const hideSpy = spyOn((component as any)._actionModal || {}, 'hide').and.callFake(() => {});

  // auditLogService may be private - access via any
  const auditSpy = spyOn((component as any).auditLogService || {}, 'writeAuditLog').and.callFake(() => {});

  // --- Act ---
  component.onAcceptButtonClick(ActionType.update);
  tick();

  // --- Assert ---
  expect(putSpy).toHaveBeenCalled();
  expect(genSpy).toHaveBeenCalled();
  expect(setMsgSpy).toHaveBeenCalledWith(jasmine.anything(), jasmine.anything());
  expect(auditSpy).toHaveBeenCalledWith(
    'taxAcctId',
    component.taxAccount.taxAcctId.toString(),
    component.selectedtaxAccount,
    jasmine.any(Object),
    jasmine.anything(),
    jasmine.any(String)
  );
  expect(clearSpy).toHaveBeenCalled();
  expect(hideSpy).toHaveBeenCalled();
}));