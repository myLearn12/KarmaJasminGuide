it('processRecord(): should set loading=true and dispatch LOADINGACTION(true)', () => {
  component.region = { regionId: 5 }; 
  component.sheetName = 'TestSheet';
  component.acctColumnHeader = 'acct';
  component.worksheet = { TestSheet: [] };

  const dispatchSpy = spyOn(store, 'dispatch');
  spyOn(component['utils'], 'ToEstDate').and.returnValue('2024-10-10');

  component.processRecord();

  expect(component.loading).toBeTrue();
  expect(dispatchSpy).toHaveBeenCalledWith(new LOADINGACTION(true));
});

it('processRecord(): should push only truthy accounts to bulk payload', () => {
  component.region = { regionId: 10 };
  component.sheetName = 'TestSheet';
  component.acctColumnHeader = 'acct';

  component.worksheet = {
    TestSheet: [
      { acct: '111' },   // valid
      null,              // ignored
      { acct: '222' }    // valid
    ]
  };

  const toEstSpy = spyOn(component['utils'], 'ToEstDate').and.returnValue('2024-10-10');

  component.processRecord();

  // bulkAcctPayload created inside processRecord()
  // so spy on push events:
  expect(toEstSpy).toHaveBeenCalledTimes(1);
});

it('processRecord(): should correctly format each payload row', () => {
  component.region = { regionId: 7 };
  component.sheetName = 'TestSheet';
  component.acctColumnHeader = 'acct';
  component.selectedMonthEndDate = '2024-10-30';

  component.worksheet = {
    TestSheet: [
      { acct: '999' }
    ]
  };

  spyOn(component['utils'], 'ToEstDate').and.returnValue('2024-10-10');

  const payloadPush = spyOn(Array.prototype, 'push');

  component.processRecord();

  expect(payloadPush).toHaveBeenCalledWith(jasmine.objectContaining({
    regionId: 7,
    acctnum: '999',
    cutOffDate: '2024-10-10'
  }));
});
