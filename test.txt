it('processRecord(): should post records, stop loading, set totalRecordCount and show modal when successful', () => {
  // Arrange
  component.loading = true;
  component.sheetName = 'Sheet1';
  component.worksheet = { Sheet1: [{ Account: '123', Amount: 200, PaidDate: '2024-10-10' }] };
  component.utils = {
    getUploadDateAndDefaultTime: () => '2024-10-10T00:00:00Z',
    getCurrentUser: () => 'testUser',
    ToEstDate: () => new Date()
  } as any;

  component.region = { regionId: 'R1' };
  component.appConfigService = { UploadCashFeeGFOPostingUrl: '/api/upload/' } as any;
  component.feeApiservice = {
    postRequest: jasmine.createSpy().and.returnValue({
      subscribe: (observer: any) => observer.next()
    })
  } as any;

  const dispatchSpy = spyOn(component['store'], 'dispatch');
  const showSpy = jasmine.createSpy();
  component['_actionModal'] = { show: showSpy };

  // Act
  component.processRecord();

  // Assert
  expect(component.loading).toBeFalse();
  expect(dispatchSpy).toHaveBeenCalledWith(jasmine.any(LOADINGACTION));
  expect(component.totalRecordCount).toBeGreaterThan(0);
  expect(showSpy).toHaveBeenCalled();
});


it('processRecord(): should handle error by displaying service error and stopping loading', () => {
  // Arrange
  component.worksheet = { Sheet1: [] };
  component.sheetName = 'Sheet1';
  component.utils = { getCurrentUser: () => 'testUser', ToEstDate: () => new Date() } as any;
  component.region = { regionId: 'R1' };
  component.appConfigService = { UploadCashFeeGFOPostingUrl: '/api/upload/' } as any;
  component.feeApiservice = {
    postRequest: jasmine.createSpy().and.returnValue({
      subscribe: (observer: any) => observer.error({ error: { statusMessage: 'Server error' } })
    })
  } as any;

  const dispatchSpy = spyOn(component['store'], 'dispatch');
  const errorSpy = spyOn(component, 'displayServiceErrors');

  // Act
  component.processRecord();

  // Assert
  expect(errorSpy).toHaveBeenCalledWith('Server error');
  expect(component.loading).toBeFalse();
  expect(dispatchSpy).toHaveBeenCalledWith(jasmine.any(LOADINGACTION));
});