it('validateWorksheet: numeric field invalid -> should mark isInvalidCharLength and call fileUploadError', fakeAsync(() => {
  // arrange - put everything inside test
  const fileErrSpy = spyOn(component as any, 'fileUploadError');
  // stub utils numeric check to return false (invalid)
  (component as any).utils = { isStringNumeric: (val: any) => false } as any;

  // prepare worksheet containing one row where 'cashAmountColumnHeader' exists but is non-numeric
  // adapt header names to match your component property names
  (component as any).cashAmountColumnHeader = 'CASH_AMT';
  const worksheet = {
    [component['sheetName'] || 'Sheet1']: [
      { 'CASH_AMT': 'abc' }   // invalid numeric
    ]
  };

  // reset flags
  component['isInvalidCharLength'] = false;
  component['isMissingRequiredField'] = false;

  // act
  (component as any).validateWorksheet(worksheet[component['sheetName'] || 'Sheet1']); // some components pass array directly

  // assert
  expect(component['isInvalidCharLength']).toBeTrue();
  expect(fileErrSpy).toHaveBeenCalled();
}));


it('validateWorksheet: missing required field -> should mark isMissingRequiredField and call fileUploadError', fakeAsync(() => {
  const fileErrSpy = spyOn(component as any, 'fileUploadError');
  // numeric validator not used here; we want missing field path
  (component as any).utils = { isStringNumeric: (v: any) => true } as any;

  // define header name that will *not* exist in row (simulate missing)
  (component as any).cashAmountColumnHeader = 'CASH_AMT';
  const worksheet = {
    [component['sheetName'] || 'Sheet1']: [
      { OTHER_COL: 'value' }  // CASH_AMT missing
    ]
  };

  component['isMissingRequiredField'] = false;

  (component as any).validateWorksheet(worksheet[component['sheetName'] || 'Sheet1']);

  expect(component['isMissingRequiredField']).toBeTrue();
  expect(fileErrSpy).toHaveBeenCalled();
}));


it('validateWorksheet: cusip length exceeded -> should mark isInvalidCharLength and call fileUploadError', fakeAsync(() => {
  const fileErrSpy = spyOn(component as any, 'fileUploadError');
  // stub alpha/numeric check to pass
  (component as any).utils = { isStringAlphaNumeric: (v: any) => true } as any;

  (component as any).cusipColumnHeader = 'CUSIP';
  // create a cusip longer than 12 chars
  const worksheet = {
    [component['sheetName'] || 'Sheet1']: [
      { 'CUSIP': 'ABCDEFGHIJKLM' } // 13 chars
    ]
  };

  component['isInvalidCharLength'] = false;

  (component as any).validateWorksheet(worksheet[component['sheetName'] || 'Sheet1']);

  expect(component['isInvalidCharLength']).toBeTrue();
  expect(fileErrSpy).toHaveBeenCalled();
}));


it('validateWorksheet: valid rows -> should mark isFileUploaded true and clear errorBlockMessage', fakeAsync(() => {
  const fileErrSpy = spyOn(component as any, 'fileUploadError');
  // make utils return valid responses
  (component as any).utils = {
    isStringNumeric: (v: any) => !isNaN(Number(v)),
    isStringAlphaNumeric: (v: any) => /^[a-z0-9]+$/i.test(String(v)),
    isValidDate: (d: any) => true
  } as any;

  // set headers used by the function
  (component as any).accountColumnHeader = 'ACCT';
  (component as any).cashAmountColumnHeader = 'CASH';
  (component as any).paidThruDateColumnHeader = 'PAID_DT';
  (component as any).sheetName = 'Sheet1';

  // create valid row
  const worksheet = {
    'Sheet1': [
      { 'ACCT': '12345', 'CASH': '100.50', 'PAID_DT': '2023-01-01' }
    ]
  };

  // reset flags
  component['isFileUploaded'] = false;
  component['errorBlockMessage'] = 'some error';

  // act - some implementations accept worksheet[sheetName] array; adjust call to match your validateWorksheet signature
  (component as any).validateWorksheet(worksheet['Sheet1']);

  expect(component['isFileUploaded']).toBeTrue();
  expect(component['errorBlockMessage']).toBeNull();
  expect(fileErrSpy).not.toHaveBeenCalled();
}));